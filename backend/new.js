import fs from 'fs';
import fetch from 'node-fetch';
import pdf from 'pdf-parse';

// üëâ Store this securely in real projects (e.g., use dotenv)
const GEMINI_API_KEY = 'AIzaSyBGR9Y2TgP8nt2KYrPdbJ5BAA-WGE_bGyk';

// ‚úÖ Full path to your PDF file
const PDF_FILE_PATH = 'e:/attendence/backend/okk.pdf';

async function extractTextFromPDF(filePath) {
  if (!fs.existsSync(filePath)) {
    console.error(`‚ùå File not found at: ${filePath}`);
    return;
  }

  try {
    const dataBuffer = fs.readFileSync(filePath);
    const data = await pdf(dataBuffer);
    const extractedText = data.text.trim();

    if (!extractedText) {
      console.log('‚ö†Ô∏è No extractable text found in PDF.');
      return;
    }

    console.log('\n‚úÖ PDF Text Extracted Successfully!\n');
    // console.log(extractedText); // Uncomment if you want to see the raw text
    await generateShortNotesWithGemini(extractedText);
  } catch (error) {
    console.error('‚ùå Failed to read PDF:', error.message);
  }
}

async function generateShortNotesWithGemini(text) {
  const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;

  const body = {
    contents: [
      {
        parts: [
          {
            text: `Create detailed short notes from this PDF content:\n\n${text}`
          }
        ]
      }
    ]
  };

  try {
    console.log('\nüîÑ Sending extracted text to Gemini...\n');

    const response = await fetch(geminiApiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    });

    if (!response.ok) {
      console.error(`‚ùå Gemini API Error (Status ${response.status}):`);
      console.error(await response.text());
      return;
    }

    const data = await response.json();
    const notes = data?.candidates?.[0]?.content?.parts?.[0]?.text;

    if (!notes) {
      console.error('‚ùå No notes returned by Gemini.');
      console.log(JSON.stringify(data, null, 2));
      return;
    }

    console.log('üìù Short Notes Generated by Gemini:\n');
    console.log(notes);
  } catch (error) {
    console.error('‚ùå Error during Gemini API request:', error.message);
  }
}

// ‚ñ∂Ô∏è Start processing
extractTextFromPDF(PDF_FILE_PATH);
